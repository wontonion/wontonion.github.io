"use strict";(self.webpackChunktestpro=self.webpackChunktestpro||[]).push([[7711],{7421:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>h,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"auth-and-security/jwt","title":"The story of JWT","description":"Start with session","source":"@site/docs/auth-and-security/jwt.mdx","sourceDirName":"auth-and-security","slug":"/auth-and-security/jwt","permalink":"/zh-Hans/docs/auth-and-security/jwt","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/auth-and-security/jwt.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"jwt-with-passportjs","permalink":"/zh-Hans/docs/auth-and-security/jwt-with-passportjs"},"next":{"title":"registration and login","permalink":"/zh-Hans/docs/auth-and-security/register-and-login-desing"}}');var i=t(6070),r=t(8637);const o={},a="The story of JWT",h={},d=[{value:"Start with session",id:"start-with-session",level:2},{value:"session",id:"session",level:3},{value:"Problem with session",id:"problem-with-session",level:3},{value:"Json Web Token",id:"json-web-token",level:2},{value:"what&#39;s inside the token",id:"whats-inside-the-token",level:2},{value:"header",id:"header",level:3},{value:"payload",id:"payload",level:3},{value:"signature",id:"signature",level:3},{value:"Deficits of JWT",id:"deficits-of-jwt",level:2},{value:"used in passport.js",id:"used-in-passportjs",level:2}];function l(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"the-story-of-jwt",children:"The story of JWT"})}),"\n",(0,i.jsx)(s.h2,{id:"start-with-session",children:"Start with session"}),"\n",(0,i.jsx)(s.h3,{id:"session",children:"session"}),"\n",(0,i.jsx)(s.p,{children:"Before look into JWT, let's see how did it come out. Image a authentication scenario."}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"User login with username and password, which means client sending with username and password to server."}),"\n",(0,i.jsx)(s.li,{children:"Server verify the username and password, if it's correct, server will store the user information in session. Here, the session is a piece of data stored user information especially the login state in server side."}),"\n",(0,i.jsx)(s.li,{children:"Then server will return a session id to client, which is stored in cookie. Cookie is stored in client side, beyond session id, it also stored other information like expiration time, domain, etc."}),"\n",(0,i.jsx)(s.li,{children:"Every time client send request to server, it will bring the cookie with session id. Server will verify the session id in cookie, if it's correct, server will return the data to client."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Take a real world scenario to explain the above steps. Say, you want to do shopping on a website"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"You log in your account with username and password. If your username and password are correct, the server will store your user information in session."}),"\n",(0,i.jsx)(s.li,{children:"The server will return a session id to your browser, which is stored in cookie."}),"\n",(0,i.jsx)(s.li,{children:"You add some items to your shopping cart. It may be stored in cookie, and may be stored in server side. If it's stored in server side, the server will authenticate your identity with the session id in cookie. That means you will send cart information with session id to server."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"So, this is how session works. But there are some problems with session."}),"\n",(0,i.jsx)(s.h3,{id:"problem-with-session",children:"Problem with session"}),"\n",(0,i.jsx)(s.p,{children:"From the example above we can see there is the user state is stored in server side. It means the server need to store the user state for every user. If there are millions of users, the server need to store millions of user state. It's a huge burden for server."}),"\n",(0,i.jsx)(s.p,{children:"And if there is only one server, what if the server is down? The user state will be lost. Maybe you choose to scale the server, but it's not a good solution. Because the user state is stored in server side, if you scale the server, you need to synchronize the user state between servers. It brings in more complexity."}),"\n",(0,i.jsx)(s.p,{children:"One solution is to write the user state in database. But it's still not a good solution. Because every time the client send request to server, the server need to read the user state from database. Then it will be a performance issue."}),"\n",(0,i.jsx)(s.p,{children:"Another solution is to store the user state in client side. Here comes the JWT."}),"\n",(0,i.jsx)(s.h2,{id:"json-web-token",children:"Json Web Token"}),"\n",(0,i.jsx)(s.p,{children:"Json Web Token(JWT) uses JSON objects to achieve authentication. This token works like a ticket with time limit. In this case, after client is authenticated, the server will give a token to client. The client will store the token in cookie or local storage. Every time the client send request to server, it will bring the token. The server will verify the token, if it's correct, the server will return the data to client."}),"\n",(0,i.jsx)(s.h2,{id:"whats-inside-the-token",children:"what's inside the token"}),"\n",(0,i.jsx)(s.p,{children:"The token is a encrypted string. It can be divided into three parts: header, payload and signature. Each part is divided by dot(.). It looks like,"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"xxxxx.yyyyy.zzzzz\n"})}),"\n",(0,i.jsx)(s.p,{children:"The header and payload are JSON objects, and the signature is the encrypted string of above two piece of information."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"header: a json object, which contains the algorithm and token type."}),"\n",(0,i.jsx)(s.li,{children:"payload: a json object, which contains the user information, expiration time, etc.(you can also add custom information)"}),"\n",(0,i.jsx)(s.li,{children:"signature: the encrypted string of above two parts."}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"header",children:"header"}),"\n",(0,i.jsx)(s.p,{children:"The header is a json object, which contains the algorithm and token type."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'{\n  "alg": "HS256",\n  "typ": "JWT"\n}\n'})}),"\n",(0,i.jsx)(s.p,{children:"Usually, the header is encoded by Base64Url in the final encrypted string."}),"\n",(0,i.jsx)(s.h3,{id:"payload",children:"payload"}),"\n",(0,i.jsx)(s.p,{children:"The payload is a json object, which contains the user information, expiration time, etc. You can also add custom information."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'{\n  "sub": "1234567890",\n  "name": "John Doe",\n  "iat": 1516239022\n}\n'})}),"\n",(0,i.jsx)(s.p,{children:"The payload is also encoded by Base64Url in the final encrypted string."}),"\n",(0,i.jsx)(s.h3,{id:"signature",children:"signature"}),"\n",(0,i.jsx)(s.p,{children:"The signature warp the header and payload. And then encrypt the warp string with secret key. The algorithm is HMACSHA256. The final encrypted string is the signature. The signature is used guarantee the token is not tampered with."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:'HMACSHA256(\n  base64UrlEncode(header) + "." +\n  base64UrlEncode(payload),\n  secret)\n'})}),"\n",(0,i.jsx)(s.h2,{id:"deficits-of-jwt",children:"Deficits of JWT"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Since JWT doesn't store the user state in server side, server cannot dispose or modify the token until it's expired. It means if the token is stolen, the thief can use the token to access the server until it's expired."}),"\n",(0,i.jsx)(s.li,{children:"In order to prevent the stolen of JWT token, the expiration time should be set as short as possible."}),"\n",(0,i.jsx)(s.li,{children:"Also, transfer the token with HTTPS is a good practice since https is more secure than http."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"used-in-passportjs",children:"used in passport.js"}),"\n",(0,i.jsx)(s.p,{children:"reference:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["(Introduction to JSON Web Tokens)[",(0,i.jsx)(s.a,{href:"https://jwt.io/introduction/",children:"https://jwt.io/introduction/"}),"]"]}),"\n",(0,i.jsxs)(s.li,{children:["(Sessionless Authentication using JWTs (with Node + Express + Passport JS))[",(0,i.jsx)(s.a,{href:"https://medium.com/@bryanmanuele/sessionless-authentication-withe-jwts-with-node-express-passport-js-69b059e4b22c",children:"https://medium.com/@bryanmanuele/sessionless-authentication-withe-jwts-with-node-express-passport-js-69b059e4b22c"}),"]"]}),"\n"]})]})}function c(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8637:(e,s,t)=>{t.d(s,{R:()=>o,x:()=>a});var n=t(758);const i={},r=n.createContext(i);function o(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);